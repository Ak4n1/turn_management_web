<app-modal [isOpen]="isOpen" title="Turnos Futuros Afectados" (close)="onClose()">

  <div class="modal-body-container">
    @if (impact) {
    <!-- Header Section -->
    <div class="header-section">
      <div class="header-content">
        <div class="warning-icon-wrapper">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div>
          <h1 class="modal-title">Turnos Futuros Afectados</h1>
          <p class="modal-subtitle">Revisa y gestiona los turnos que se verían afectados por este cambio de
            configuración</p>
        </div>
      </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Turnos Afectados</div>
        <div class="stat-value">{{ impact.existingAppointmentsAffected }}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Días Afectados</div>
        <div class="stat-value">{{ impact.affectedDays }}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Slots Perdidos</div>
        <div class="stat-value">{{ impact.slotsLost }}</div>
      </div>
    </div>

    <!-- List Section -->
    <div class="list-section">
      <h2 class="list-title">
        <i class="fas fa-list-alt"></i>
        Detalle de Turnos
      </h2>

      <div class="appointments-list custom-scrollbar">
        @if (paginatedAppointments.length > 0) {
        @for (appointment of paginatedAppointments; track appointment.id || appointment.date + appointment.time) {
        <div class="appointment-item">
          <div class="appointment-main">
            <div class="user-avatar">
              {{ getUserInitials(appointment) }}
            </div>
            <div>
              <h3 class="user-name">{{ getUserFullName(appointment) }}</h3>
              <p class="appointment-date">{{ formatAppointmentDate(appointment) }}</p>
            </div>
          </div>
          <div class="appointment-time-wrapper">
            <div class="appointment-time-badge">{{ formatAppointmentTime(appointment) }}</div>
          </div>
        </div>
        }
        } @else {
        <div class="empty-message">No hay turnos para mostrar.</div>
        }
      </div>

      <!-- Pagination (kept simple for now, matching style if needed or using existing) -->
      @if (totalPages > 1) {
      <div class="pagination">
        <button type="button" class="pagination-btn" [disabled]="currentPage === 0" (click)="previousPage()">
          <i class="fas fa-chevron-left"></i>
        </button>

        <span class="pagination-info">
          {{ currentPage + 1 }} / {{ totalPages }}
        </span>

        <button type="button" class="pagination-btn" [disabled]="currentPage === totalPages - 1" (click)="nextPage()">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
      }
    </div>

    <!-- Settings Section -->
    <div class="settings-section">
      <div class="settings-header">
        <div class="settings-info">
          <h3 class="settings-title">Cancelar automáticamente</h3>
          <p class="settings-description">Si está activado, los turnos afectados se cancelarán y se notificará a los
            usuarios por email.</p>
        </div>
        <label class="switch">
          <input type="checkbox" [(ngModel)]="autoCancelAffectedAppointments">
          <span class="slider round"></span>
        </label>
      </div>

      @if (autoCancelAffectedAppointments) {
      <div class="reason-container">
        <label class="reason-label">Razón de la cancelación (personalizable)</label>
        <textarea class="reason-textarea" [(ngModel)]="cancellationReason" rows="3" placeholder="Escribe el motivo...">
            </textarea>
        <p class="reason-hint">
          <i class="fas fa-info-circle"></i>
          Esta razón será incluida en el email que se enviará a los usuarios afectados.
        </p>
      </div>
      }
    </div>

    <!-- Info Box -->
    <div class="info-box">
      <i class="fas fa-info-circle info-icon"></i>
      <p class="info-text">
        @if (autoCancelAffectedAppointments) {
        <strong>Nota:</strong> Los turnos afectados serán gestionados automáticamente al confirmar. Asegúrate de haber
        revisado la lista antes de continuar. ¿Deseas continuar con el guardado?
        } @else {
        <strong>Nota:</strong> Los turnos existentes mantendrán su versión original de configuración, pero los nuevos
        turnos usarán la nueva configuración.
        }
      </p>
    </div>

    <!-- Actions -->
    <div class="modal-footer">
      <button type="button" class="btn-cancel" (click)="onCancel()">
        <i class="fas fa-times"></i>
        Cancelar
      </button>
      <button type="button" class="btn-confirm" (click)="onConfirm()">
        <i class="fas fa-check-circle"></i>
        Continuar con el Guardado
      </button>
    </div>

    }
  </div>
</app-modal>