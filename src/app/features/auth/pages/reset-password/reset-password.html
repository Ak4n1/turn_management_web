<div class="auth-layout">
  <app-public-navbar></app-public-navbar>
  <main class="auth-content">
    <div class="auth-container">
      <div class="reset-password-form-wrapper">
        @if (state === 'loading') {
          <div class="reset-password-loading">
            <div class="spinner"></div>
            <h2 class="form-title">Cargando...</h2>
            <p class="form-subtitle">Por favor, espera mientras verificamos el enlace.</p>
          </div>
        }

        @if (state === 'success') {
          <div class="reset-password-success">
            <div class="success-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <h2 class="form-title">¡Contraseña restablecida exitosamente!</h2>
            <p class="form-subtitle">
              Ya puedes iniciar sesión con tu nueva contraseña.
            </p>
            <p class="success-info">Se ha enviado un email de confirmación.</p>
            <app-button
              type="button"
              variant="primary"
              size="large"
              (clicked)="goToLogin()"
              ariaLabel="Ir a iniciar sesión"
              class="submit-button">
              <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
              Iniciar Sesión
            </app-button>
          </div>
        }

        @if (state === 'error') {
          <div class="reset-password-error">
            <div class="error-icon">
              <i class="fas fa-exclamation-circle"></i>
            </div>
            <h2 class="form-title">Token inválido o expirado</h2>
            <p class="form-subtitle">{{ errorMessage || 'El enlace de restablecimiento ha expirado o ya ha sido utilizado.' }}</p>
            <div class="error-actions">
              <app-button
                type="button"
                variant="primary"
                size="large"
                (clicked)="goToForgotPassword()"
                ariaLabel="Solicitar nuevo token de restablecimiento"
                class="submit-button">
                <i class="fas fa-paper-plane" aria-hidden="true"></i>
                Solicitar nuevo token de restablecimiento
              </app-button>
              <app-button
                type="button"
                variant="secondary"
                size="large"
                (clicked)="goToLogin()"
                ariaLabel="Volver a iniciar sesión"
                class="submit-button">
                <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
                Volver a Iniciar Sesión
              </app-button>
            </div>
          </div>
        }

        @if (state === 'form') {
          <h2 class="form-title">Restablecer Contraseña</h2>
          <p class="form-subtitle">
            Ingresa tu nueva contraseña. Asegúrate de que sea segura y diferente a la anterior.
          </p>

          <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="reset-password-form" novalidate>
            @if (errorMessage) {
              <div class="form-error-banner" role="alert">
                <p>{{ errorMessage }}</p>
              </div>
            }

            <app-password-input
              label="Nueva Contraseña"
              labelIcon="fa-lock"
              placeholder="Ingrese su nueva contraseña"
              id="newPassword"
              name="newPassword"
              [required]="true"
              [errorMessage]="getNewPasswordError()"
              autocomplete="new-password"
              formControlName="newPassword">
            </app-password-input>

            <app-password-input
              label="Confirmar Contraseña"
              labelIcon="fa-lock"
              placeholder="Repite tu nueva contraseña"
              id="confirmPassword"
              name="confirmPassword"
              [required]="true"
              [errorMessage]="getConfirmPasswordError()"
              autocomplete="new-password"
              formControlName="confirmPassword">
            </app-password-input>

            <app-button
              type="submit"
              variant="primary"
              size="large"
              [disabled]="!isFormValid()"
              [loading]="isSubmitting"
              ariaLabel="Cambiar contraseña"
              [attr.aria-busy]="isSubmitting"
              class="submit-button">
              <i class="fas fa-key" aria-hidden="true"></i>
              Cambiar Contraseña
            </app-button>

            <p class="form-footer">
              ¿Recordaste tu contraseña?
              <a routerLink="/login" class="form-link">Volver a iniciar sesión</a>
            </p>
          </form>
        }
      </div>
    </div>
  </main>
  <footer class="auth-footer">
    <p class="footer-text">&copy; 2024 TurnFlow. Todos los derechos reservados.</p>
  </footer>
</div>

