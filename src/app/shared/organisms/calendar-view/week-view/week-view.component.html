<div class="week-view">
    <!-- Days Header -->
    <div class="week-header">
        <div class="time-gutter-header"></div>
        @for (day of days; track day.dateString) {
        <div class="day-header" [class.is-today]="day.isToday" [class.day-closed]="day.state === 'closed'"
            (click)="onDayClick(day)">
            <span class="day-name">{{ day.dayName }}</span>
            <span class="day-number" [class.today-number]="day.isToday">{{ day.dayNumber }}</span>
        </div>
        }
    </div>

    <!-- Time Grid -->
    <div class="week-grid">
        <div class="grid-body">
            @for (slot of timeSlots; track slot.hour) {
            <div class="time-row">
                <!-- Time Label -->
                <div class="time-label">
                    <span>{{ slot.label }}</span>
                </div>

                <!-- Day Cells (Drawn as backgrounds) -->
                @for (day of days; track day.dateString) {
                <div class="day-cell" [class.is-today]="day.isToday" [class.slot-closed]="!isSlotOpen(day, slot.hour)"
                    (click)="onSlotClick(day, slot)">
                </div>
                }
            </div>
            }

            <!-- Events Layer (Relative to the whole grid) -->
            <div class="events-containers">
                <!-- Spacer for gutter -->
                <div class="gutter-spacer"></div>

                @for (day of days; track day.dateString) {
                <div class="day-events-column">
                    @for (occ of day.occupiedSlots || []; track occ.start + occ.end) {
                    <div class="event-card slot-occupied" [ngStyle]="getOccupiedSlotStyle(occ)"
                        (click)="$event.stopPropagation()">
                        <span class="event-time">{{ occ.start }} - {{ occ.end }}</span>
                        <span class="event-title">Ocupado</span>
                    </div>
                    }
                    @for (event of day.events; track event.id) {
                    <div class="event-card" [class]="getStatusClass(event.status)" [ngStyle]="getEventStyle(event)"
                        (click)="onEventClick(event, $event)">
                        <span class="event-time">{{ formatEventTime(event) }}</span>
                        <span class="event-title">{{ event.title }}</span>
                    </div>
                    }
                </div>
                }
            </div>
        </div>
    </div>
</div>